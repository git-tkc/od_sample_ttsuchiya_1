name: CI

on: [push]

jobs:
  prepare:
    runs-on: ubuntu-latest
    steps:
      - name: check php version
        run: php -v

  build:
    runs-on: ubuntu-latest
    needs: prepare
    steps:
    - uses: actions/checkout@v2
    - name: all php files syntax check
      run: find ./ -type f -name '*.php' | xargs -n1 php -l
    - name: post slack messages
      if: failure()
      uses: pullreminders/slack-action@master
      env:
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      with:
        args: '{\"channel\":\"CTP90F42H\",\"attachments\":\"`repos:${{ github.repository }}`%0A`workflow:${{ github.workflow }}`%0A`step:[all php files syntax check]`%0Aでエラーが発生しました - \"}'

